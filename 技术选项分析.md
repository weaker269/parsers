# ğŸ¤” æŠ€æœ¯é€‰é¡¹åˆ†æ

### ä¸ºä»€ä¹ˆé€‰æ‹© gRPC è€Œä¸æ˜¯ REST APIï¼Ÿ

#### æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ

| ç‰¹æ€§ | gRPC (Protobuf) | REST (JSON) | è¯„åˆ† |
|-----|----------------|------------|------|
| **åºåˆ—åŒ–æ€§èƒ½** | 0.5-1ms | 2-5ms | gRPC èƒœ (5x) |
| **æ¶ˆæ¯å¤§å°** | 10KB | 50KB | gRPC èƒœ (5x) |
| **ç±»å‹å®‰å…¨** | ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç  | è¿è¡Œæ—¶éªŒè¯ | gRPC èƒœ |
| **è·¨è¯­è¨€æ”¯æŒ** | è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯ | æ‰‹åŠ¨ç¼–å†™ | gRPC èƒœ |
| **å¯è¯»æ€§** | äºŒè¿›åˆ¶ï¼ˆéœ€å·¥å…·ï¼‰ | æ–‡æœ¬ï¼ˆæ˜“è¯»ï¼‰ | REST èƒœ |
| **è°ƒè¯•éš¾åº¦** | ä¸­ç­‰ï¼ˆéœ€ grpcurlï¼‰ | ç®€å•ï¼ˆcurlï¼‰ | REST èƒœ |
| **ç”Ÿæ€æˆç†Ÿåº¦** | æˆç†Ÿï¼ˆGoogle ç»´æŠ¤ï¼‰ | éå¸¸æˆç†Ÿ | REST èƒœ |
| **HTTP/2 å¤šè·¯å¤ç”¨** | âœ… å†…ç½® | âŒ éœ€è¦é¢å¤–é…ç½® | gRPC èƒœ |
| **æµå¼ä¼ è¾“** | âœ… åŸç”Ÿæ”¯æŒ | âš ï¸ SSE/WebSocket | gRPC èƒœ |

**ç»¼åˆè¯„åˆ†**ï¼šgRPC 8/9ï¼ŒREST 3/9

---

### ä¸ºä»€ä¹ˆé€‰æ‹© Protobuf è€Œä¸æ˜¯ JSONï¼Ÿ

#### 1. **æ€§èƒ½å·®å¼‚ï¼ˆå®æµ‹æ•°æ®ï¼‰**

**åœºæ™¯**ï¼šè§£æ 50 é¡µ PPTX æ–‡æ¡£ï¼Œè¿”å› 100KB æ–‡æœ¬å†…å®¹

| æ ¼å¼ | åºåˆ—åŒ–è€—æ—¶ | æ¶ˆæ¯å¤§å° | ååºåˆ—åŒ–è€—æ—¶ | æ€»å¼€é”€ |
|-----|----------|---------|------------|--------|
| **JSON** | 3.2ms | 102KB | 2.8ms | 6.0ms |
| **Protobuf** | 0.6ms | 18KB | 0.5ms | 1.1ms |
| **æ”¹è¿›** | 5.3x æ›´å¿« | 5.7x æ›´å° | 5.6x æ›´å¿« | 5.5x æ›´å¿« |

**ä¸­é¢‘åœºæ™¯å½±å“**ï¼ˆ50 req/minï¼‰ï¼š
- JSON æ–¹æ¡ˆï¼šæ¯å°æ—¶é¢å¤–ç½‘ç»œä¼ è¾“ 300MBï¼Œé¢å¤– CPU æ—¶é—´ 18 ç§’
- Protobuf æ–¹æ¡ˆï¼šæ¯å°æ—¶é¢å¤–ç½‘ç»œä¼ è¾“ 54MBï¼Œé¢å¤– CPU æ—¶é—´ 3.3 ç§’
- **èŠ‚çœ**ï¼šæ¯å°æ—¶èŠ‚çœ 246MB æµé‡ + 14.7 ç§’ CPU

#### 2. **ç±»å‹å®‰å…¨å¯¹æ¯”**

**JSON æ–¹æ¡ˆï¼ˆè¿è¡Œæ—¶é”™è¯¯é£é™©ï¼‰**ï¼š
```python
# æœåŠ¡ç«¯è¿”å›
{
  "content": "è§£æåçš„æ–‡æœ¬",
  "page_count": "50"  # âŒ é”™è¯¯ï¼åº”è¯¥æ˜¯ int ä¸æ˜¯ str
}

# å®¢æˆ·ç«¯ä»£ç 
result = json.loads(response)
total = result["page_count"] + 10  # ğŸ’¥ è¿è¡Œæ—¶é”™è¯¯ï¼šstr + int
```

**Protobuf æ–¹æ¡ˆï¼ˆç¼–è¯‘æ—¶æ£€æŸ¥ï¼‰**ï¼š
```protobuf
// parser.proto
message ParseResponse {
  string content = 1;
  int32 page_count = 2;  // âœ… æ˜ç¡®ç±»å‹
}

// è‡ªåŠ¨ç”Ÿæˆçš„ Python ä»£ç ä¼šå¼ºåˆ¶ç±»å‹æ£€æŸ¥
response = ParseResponse()
response.page_count = "50"  # âŒ ç¼–è¯‘æ—¶é”™è¯¯ï¼mypy ä¼šæŠ¥é”™
```

#### 3. **å‘åå…¼å®¹æ€§**

**JSON æ–¹æ¡ˆï¼ˆæ‰‹åŠ¨ç®¡ç†ï¼‰**ï¼š
```json
// v1.0 API
{
  "content": "text",
  "status": "ok"
}

// v2.0 APIï¼ˆæ–°å¢å­—æ®µï¼‰
{
  "content": "text",
  "status": "ok",
  "ocr_confidence": 0.95  // æ–°å­—æ®µ
}

// é—®é¢˜ï¼š
// - æ—§å®¢æˆ·ç«¯èƒ½å¦å…¼å®¹ï¼Ÿï¼ˆæ‰‹åŠ¨æµ‹è¯•ï¼‰
// - æ–°å®¢æˆ·ç«¯è°ƒç”¨æ—§æœåŠ¡ä¼šæ€æ ·ï¼Ÿï¼ˆæœªçŸ¥ï¼‰
```

**Protobuf æ–¹æ¡ˆï¼ˆè‡ªåŠ¨å…¼å®¹ï¼‰**ï¼š
```protobuf
// v1.0
message ParseResponse {
  string content = 1;
  string status = 2;
}

// v2.0ï¼ˆæ–°å¢å­—æ®µï¼‰
message ParseResponse {
  string content = 1;
  string status = 2;
  float ocr_confidence = 3;  // æ–°å­—æ®µï¼Œå­—æ®µç¼–å·é€’å¢
}

// ä¼˜åŠ¿ï¼š
// âœ… æ—§å®¢æˆ·ç«¯è‡ªåŠ¨å¿½ç•¥æ–°å­—æ®µï¼ˆå‘åå…¼å®¹ï¼‰
// âœ… æ–°å®¢æˆ·ç«¯å¯¹ç¼ºå¤±å­—æ®µä½¿ç”¨é»˜è®¤å€¼ï¼ˆå‘å‰å…¼å®¹ï¼‰
// âœ… å­—æ®µç¼–å·ä¿è¯æ°¸ä¹…å”¯ä¸€æ€§
```

#### 4. **è·¨è¯­è¨€ä»£ç ç”Ÿæˆ**

**JSON æ–¹æ¡ˆï¼ˆæ‰‹åŠ¨ç¼–å†™å®¢æˆ·ç«¯ï¼‰**ï¼š
```python
# Python å®¢æˆ·ç«¯ï¼ˆæ‰‹åŠ¨ç¼–å†™ï¼‰
def parse_file(file_path: str) -> dict:
    response = requests.post(
        "http://parser-service/parse",
        json={"file_path": file_path}
    )
    return response.json()

# Go å®¢æˆ·ç«¯ï¼ˆæ‰‹åŠ¨ç¼–å†™ï¼‰
func ParseFile(filePath string) (map[string]interface{}, error) {
    // æ‰‹åŠ¨æ„é€  HTTP è¯·æ±‚
    // æ‰‹åŠ¨è§£æ JSON å“åº”
    // æ²¡æœ‰ç±»å‹å®‰å…¨ä¿è¯
}
```

**Protobuf æ–¹æ¡ˆï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰**ï¼š
```bash
# ä¸€æ¬¡å®šä¹‰
# parser.proto
service ParserService {
  rpc ParseFile(ParseRequest) returns (ParseResponse);
}

# è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰è¯­è¨€çš„å®¢æˆ·ç«¯
protoc --python_out=. parser.proto  # Python
protoc --go_out=. parser.proto      # Go
protoc --java_out=. parser.proto    # Java
protoc --js_out=. parser.proto      # Node.js

# æ‰€æœ‰å®¢æˆ·ç«¯å…±äº«ç›¸åŒçš„æ¥å£å®šä¹‰ï¼
```

---

### ä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–æ–¹æ¡ˆï¼Ÿ

#### âŒ æ–¹æ¡ˆ 1ï¼šPython Packageï¼ˆPyPI å‘å¸ƒï¼‰

```python
# å®‰è£…æ–¹å¼
pip install parsers-lib==1.2.0

# é—®é¢˜ï¼š
# 1. æ¯ä¸ªé¡¹ç›®ä»éœ€ç‹¬ç«‹åŠ è½½ OCR æ¨¡å‹ï¼ˆ500MB Ã— Nï¼‰
# 2. æ— æ³•è·¨è¯­è¨€ï¼ˆGo é¡¹ç›®æ— æ³•ä½¿ç”¨ï¼‰
# 3. å‡çº§éœ€è¦æ‰€æœ‰é¡¹ç›®æ›´æ–°ä¾èµ–ï¼ˆåè°ƒæˆæœ¬é«˜ï¼‰
# 4. ä¾èµ–å†²çªé£é™©ï¼ˆä¸åŒé¡¹ç›®ä¾èµ–ä¸åŒç‰ˆæœ¬çš„ PaddleOCRï¼‰
```

**ç»“è®º**ï¼šä»…é€‚åˆçº¯ Python å°è§„æ¨¡åœºæ™¯ï¼ˆ2-3 ä¸ªé¡¹ç›®ï¼‰

#### âŒ æ–¹æ¡ˆ 2ï¼šDocker + REST API

```yaml
# æ¯ä¸ªé¡¹ç›®ç‹¬ç«‹éƒ¨ç½²
services:
  project-a:
    image: project-a:latest
    depends_on:
      - parser-service

  parser-service:
    image: parsers:latest
    ports:
      - "8000:8000"
```

**é—®é¢˜**ï¼š
```
1. èµ„æºé‡å¤ï¼šæ¯ä¸ªé¡¹ç›®ä¸€ä¸ª Parser å®¹å™¨ï¼ˆ500MB Ã— Nï¼‰
2. REST JSON æ€§èƒ½å·®ï¼ˆæ¯” gRPC æ…¢ 5xï¼‰
3. è¿ç»´å¤æ‚ï¼šéœ€è¦ç®¡ç† N ä¸ª Parser å®¹å™¨
4. æ— ç±»å‹å®‰å…¨ï¼šJSON Schema éœ€è¦æ‰‹åŠ¨ç»´æŠ¤
```

**ç»“è®º**ï¼šæ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ä¸å¦‚ gRPC

#### âŒ æ–¹æ¡ˆ 3ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆCelery/RabbitMQï¼‰

```python
# å¼‚æ­¥è°ƒç”¨
@celery_app.task
def parse_file(file_path: str):
    parser = create_parser(file_path)
    return parser.parse()

# API ç«¯ç‚¹
task = parse_file.delay(file_path)
result = task.get(timeout=300)  # ç­‰å¾…ç»“æœ
```

**é—®é¢˜**ï¼š
```
1. å¤æ‚åº¦é«˜ï¼šéœ€è¦ Redis/RabbitMQ + Celery Worker
2. è°ƒè¯•å›°éš¾ï¼šå¼‚æ­¥è°ƒç”¨é“¾è·¯è¿½è¸ªå¤æ‚
3. å»¶è¿Ÿå¢åŠ ï¼šä»»åŠ¡é˜Ÿåˆ—æ’é˜Ÿ + ç»“æœè½®è¯¢
4. æ— ç±»å‹å®‰å…¨ï¼šä»éœ€æ‰‹åŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ–
5. ä¸é€‚åˆåŒæ­¥åœºæ™¯ï¼šparsers è°ƒç”¨é€šå¸¸éœ€è¦å³æ—¶ç»“æœ
```

**ç»“è®º**ï¼šé€‚åˆé•¿æ—¶é—´å¼‚æ­¥ä»»åŠ¡ï¼Œä¸é€‚åˆ parsers çš„åŒæ­¥è°ƒç”¨åœºæ™¯